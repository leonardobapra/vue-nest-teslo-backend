import{S as qt,q as Kt,v as at,x as Wt,y as Gt,z,A as Ht,B as Xt,C as ke,D as Yt,m as ee,E as Qt,G as Jt,H as St,I as Zt,J as xt,p as Te,l as Y,K as y,u as x,L as er,M as ut,N as tr,w as wt,O as Z,P as rr,Q as nr,R as sr,T as ct,d as Ze,c as H,o as X,a as S,U as xe,n as et,t as Ae,_ as tt,V as ir,W as or,X as lr,Y as Ie,Z as dt,h as Xe,j as ar,f as Se,$ as me,F as Fe,r as Ye,a0 as ur,a1 as cr}from"./index-pkLmPa_i.js";import{u as dr,g as fr,a as vr}from"./get-product-image.action-D7DOYQUY.js";var mr=class extends qt{#t;#n=void 0;#e;#r;constructor(e,t){super(),this.#t=e,this.setOptions(t),this.bindMethods(),this.#s()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const t=this.options;this.options=this.#t.defaultMutationOptions(e),Kt(this.options,t)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),t?.mutationKey&&this.options.mutationKey&&at(t.mutationKey)!==at(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(e){this.#s(),this.#i(e)}getCurrentResult(){return this.#n}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#s(),this.#i()}mutate(e,t){return this.#r=t,this.#e?.removeObserver(this),this.#e=this.#t.getMutationCache().build(this.#t,this.options),this.#e.addObserver(this),this.#e.execute(e)}#s(){const e=this.#e?.state??Wt();this.#n={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#i(e){Gt.batch(()=>{if(this.#r&&this.hasListeners()){const t=this.#n.variables,r=this.#n.context,n={client:this.#t,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#r.onSuccess?.(e.data,t,r,n),this.#r.onSettled?.(e.data,null,t,r,n)):e?.type==="error"&&(this.#r.onError?.(e.error,t,r,n),this.#r.onSettled?.(void 0,e.error,t,r,n))}this.listeners.forEach(t=>{t(this.#n)})})}};function pr(e,t){const r=dr(),n=z(()=>r.defaultMutationOptions(Ht(e))),l=new mr(r,n.value),o=n.value.shallow?Xt(l.getCurrentResult()):ke(l.getCurrentResult()),v=l.subscribe(d=>{Yt(o,d)}),g=(d,E)=>{l.mutate(d,E).catch(()=>{})};ee(n,()=>{l.setOptions(n.value)}),Qt(()=>{v()});const O=n.value.shallow?Jt(o):St(o),u=Zt(O);return ee(()=>o.error,d=>{if(d&&xt(n.value.throwOnError,[d]))throw d}),{...u,mutate:g,mutateAsync:o.mutate,reset:o.reset}}const hr=async e=>{if(console.log("Fetching product with ID:",e),e==="create")return{id:"",title:"",slug:"",description:"",price:0,stock:0,images:[],tags:[],gender:"",user:{},sizes:[]};try{const{data:t}=await Te.get(`/products/${e}`);return{...t,images:t.images.map(fr)}}catch(t){throw console.error("Error fetching product by ID:",t),new Error("error getting product by id")}},gr=async e=>{const t=e.id,r=await Vr(e.images??[]);return e.images=r,e=yr(e),t&&t!==""?await br(t,e):await Or(e)},yr=e=>{const t=e.images?.map(r=>r.startsWith("http")?r.split("/").pop()?r:"":r)??[];return delete e.id,delete e.user,e.images=t,e},br=async(e,t)=>{try{const{data:r}=await Te.patch(`/products/${e}`,t);return r}catch(r){throw console.log(r),new Error("Error updating product")}},Or=async e=>{try{const{data:t}=await Te.post("/products",e);return t}catch(t){throw console.log(t),new Error("Error creating product")}},Vr=async e=>{const t=e.filter(o=>o instanceof File),r=e.filter(o=>typeof o=="string"),n=t.map(async o=>{try{const v=new FormData;v.append("file",o);const{data:g}=await Te.post("/files/product",v);return g.secureUrl}catch(v){throw console.log(v),new Error("Error uploading file")}}),l=await Promise.all(n);return[...r,...l]};function Q(e){return typeof e=="function"}function pe(e){return e==null}const he=e=>e!==null&&!!e&&typeof e=="object"&&!Array.isArray(e);function rt(e){return Number(e)>=0}function Sr(e){return typeof e=="object"&&e!==null}function wr(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}function ft(e){if(!Sr(e)||wr(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Ee(e,t){return Object.keys(t).forEach(r=>{if(ft(t[r])&&ft(e[r])){e[r]||(e[r]={}),Ee(e[r],t[r]);return}e[r]=t[r]}),e}function Pe(e){const t=e.split(".");if(!t.length)return"";let r=String(t[0]);for(let n=1;n<t.length;n++){if(rt(t[n])){r+=`[${t[n]}]`;continue}r+=`.${t[n]}`}return r}const Ar={};function Er(e){return Ar[e]}function vt(e,t,r){typeof r.value=="object"&&(r.value=A(r.value)),!r.enumerable||r.get||r.set||!r.configurable||!r.writable||t==="__proto__"?Object.defineProperty(e,t,r):e[t]=r.value}function A(e){if(typeof e!="object")return e;var t=0,r,n,l,o=Object.prototype.toString.call(e);if(o==="[object Object]"?l=Object.create(e.__proto__||null):o==="[object Array]"?l=Array(e.length):o==="[object Set]"?(l=new Set,e.forEach(function(v){l.add(A(v))})):o==="[object Map]"?(l=new Map,e.forEach(function(v,g){l.set(A(g),A(v))})):o==="[object Date]"?l=new Date(+e):o==="[object RegExp]"?l=new RegExp(e.source,e.flags):o==="[object DataView]"?l=new e.constructor(A(e.buffer)):o==="[object ArrayBuffer]"?l=e.slice(0):o.slice(-6)==="Array]"&&(l=new e.constructor(e)),l){for(n=Object.getOwnPropertySymbols(e);t<n.length;t++)vt(l,n[t],Object.getOwnPropertyDescriptor(e,n[t]));for(t=0,n=Object.getOwnPropertyNames(e);t<n.length;t++)Object.hasOwnProperty.call(l,r=n[t])&&l[r]===e[r]||vt(l,r,Object.getOwnPropertyDescriptor(e,r))}return l||e}const At=Symbol("vee-validate-form"),jr=Symbol("vee-validate-form-context"),Cr=typeof window<"u";function Ir(e){return Q(e)&&!!e.__locatorRef}function ie(e){return!!e&&Q(e.parse)&&e.__type==="VVTypedSchema"}function Et(e){return!!e&&Q(e.validate)}function Fr(e){return e==="checkbox"||e==="radio"}function Pr(e){return he(e)||Array.isArray(e)}function _r(e){return Array.isArray(e)?e.length===0:he(e)&&Object.keys(e).length===0}function Me(e){return/^\[.+\]$/i.test(e)}function Nr(e){return jt(e)&&e.multiple}function jt(e){return e.tagName==="SELECT"}function kr(e){return Ct(e)&&e.target&&"submit"in e.target}function Ct(e){return e?!!(typeof Event<"u"&&Q(Event)&&e instanceof Event||e&&e.srcElement):!1}function oe(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,n,l;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(!oe(e[n],t[n]))return!1;return!0}if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(n of e.entries())if(!t.has(n[0]))return!1;for(n of e.entries())if(!oe(n[1],t.get(n[0])))return!1;return!0}if(pt(e)&&pt(t))return!(e.size!==t.size||e.name!==t.name||e.lastModified!==t.lastModified||e.type!==t.type);if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(n of e.entries())if(!t.has(n[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(e[n]!==t[n])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(e=mt(e),t=mt(t),l=Object.keys(e),r=l.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,l[n]))return!1;for(n=r;n--!==0;){var o=l[n];if(!oe(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}function mt(e){return Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0))}function pt(e){return Cr?e instanceof File:!1}function nt(e){return Me(e)?e.replace(/\[|\]/gi,""):e}function M(e,t,r){return e?Me(t)?e[nt(t)]:(t||"").split(/\.|\[(\d+)\]/).filter(Boolean).reduce((l,o)=>Pr(l)&&o in l?l[o]:r,e):r}function R(e,t,r){if(Me(t)){e[nt(t)]=r;return}const n=t.split(/\.|\[(\d+)\]/).filter(Boolean);let l=e;for(let o=0;o<n.length;o++){if(o===n.length-1){l[n[o]]=r;return}(!(n[o]in l)||pe(l[n[o]]))&&(l[n[o]]=rt(n[o+1])?[]:{}),l=l[n[o]]}}function Qe(e,t){if(Array.isArray(e)&&rt(t)){e.splice(Number(t),1);return}he(e)&&delete e[t]}function ht(e,t){if(Me(t)){delete e[nt(t)];return}const r=t.split(/\.|\[(\d+)\]/).filter(Boolean);let n=e;for(let o=0;o<r.length;o++){if(o===r.length-1){Qe(n,r[o]);break}if(!(r[o]in n)||pe(n[r[o]]))break;n=n[r[o]]}const l=r.map((o,v)=>M(e,r.slice(0,v).join(".")));for(let o=l.length-1;o>=0;o--)if(_r(l[o])){if(o===0){Qe(e,r[0]);continue}Qe(l[o-1],r[o-1])}}function G(e){return Object.keys(e)}function Tr(e,t=void 0){const r=nr();return r?.provides[e]||sr(e,t)}function gt(e,t=0){let r=null,n=[];return function(...l){return r&&clearTimeout(r),r=setTimeout(()=>{const o=e(...l);n.forEach(v=>v(o)),n=[]},t),new Promise(o=>n.push(o))}}function Mr(e,t){let r;return async function(...l){const o=e(...l);r=o;const v=await o;return o!==r?v:(r=void 0,t(v,l))}}function Rr({get:e,set:t}){const r=Y(A(e()));return ee(e,n=>{oe(n,r.value)||(r.value=A(n))},{deep:!0}),ee(r,n=>{oe(n,e())||t(A(n))},{deep:!0}),r}function yt(e){return Array.isArray(e)?e:e?[e]:[]}function _e(e,t){const r={};for(const n in e)t.includes(n)||(r[n]=e[n]);return r}function Ur(e){let t=null,r=[];return function(...n){const l=Z(()=>{if(t!==l)return;const o=e(...n);r.forEach(v=>v(o)),r=[],t=null});return t=l,new Promise(o=>r.push(o))}}function Je(e){if(It(e))return e._value}function It(e){return"_value"in e}function $r(e){return e.type==="number"||e.type==="range"?Number.isNaN(e.valueAsNumber)?e.value:e.valueAsNumber:e.value}function bt(e){if(!Ct(e))return e;const t=e.target;if(Fr(t.type)&&It(t))return Je(t);if(t.type==="file"&&t.files){const r=Array.from(t.files);return t.multiple?r:r[0]}if(Nr(t))return Array.from(t.options).filter(r=>r.selected&&!r.disabled).map(Je);if(jt(t)){const r=Array.from(t.options).find(n=>n.selected);return r?Je(r):t.value}return $r(t)}function Dr(e){const t={};return Object.defineProperty(t,"_$$isNormalized",{value:!0,writable:!1,enumerable:!1,configurable:!1}),e?he(e)&&e._$$isNormalized?e:he(e)?Object.keys(e).reduce((r,n)=>{const l=zr(e[n]);return e[n]!==!1&&(r[n]=Ot(l)),r},t):typeof e!="string"?t:e.split("|").reduce((r,n)=>{const l=Br(n);return l.name&&(r[l.name]=Ot(l.params)),r},t):t}function zr(e){return e===!0?[]:Array.isArray(e)||he(e)?e:[e]}function Ot(e){const t=r=>typeof r=="string"&&r[0]==="@"?Lr(r.slice(1)):r;return Array.isArray(e)?e.map(t):e instanceof RegExp?[e]:Object.keys(e).reduce((r,n)=>(r[n]=t(e[n]),r),{})}const Br=e=>{let t=[];const r=e.split(":")[0];return e.includes(":")&&(t=e.split(":").slice(1).join(":").split(",")),{name:r,params:t}};function Lr(e){const t=r=>{var n;return(n=M(r,e))!==null&&n!==void 0?n:r[e]};return t.__locatorRef=e,t}const qr={generateMessage:({field:e})=>`${e} is not valid.`,bails:!0,validateOnBlur:!0,validateOnChange:!0,validateOnInput:!1,validateOnModelUpdate:!0};let Kr=Object.assign({},qr);const we=()=>Kr;async function Wr(e,t,r={}){const n=r?.bails,l={name:r?.name||"{field}",rules:t,label:r?.label,bails:n??!0,formData:r?.values||{}},o=await Gr(l,e);return Object.assign(Object.assign({},o),{valid:!o.errors.length})}async function Gr(e,t){const r=e.rules;if(ie(r)||Et(r))return Xr(t,Object.assign(Object.assign({},e),{rules:r}));if(Q(r)||Array.isArray(r)){const g={field:e.label||e.name,name:e.name,label:e.label,form:e.formData,value:t},O=Array.isArray(r)?r:[r],u=O.length,d=[];for(let E=0;E<u;E++){const I=O[E],N=await I(t,g);if(!(typeof N!="string"&&!Array.isArray(N)&&N)){if(Array.isArray(N))d.push(...N);else{const K=typeof N=="string"?N:Pt(g);d.push(K)}if(e.bails)return{errors:d}}}return{errors:d}}const n=Object.assign(Object.assign({},e),{rules:Dr(r)}),l=[],o=Object.keys(n.rules),v=o.length;for(let g=0;g<v;g++){const O=o[g],u=await Yr(n,t,{name:O,params:n.rules[O]});if(u.error&&(l.push(u.error),e.bails))return{errors:l}}return{errors:l}}function Hr(e){return!!e&&e.name==="ValidationError"}function Ft(e){return{__type:"VVTypedSchema",async parse(r,n){var l;try{return{output:await e.validate(r,{abortEarly:!1,context:n?.formData||{}}),errors:[]}}catch(o){if(!Hr(o))throw o;if(!(!((l=o.inner)===null||l===void 0)&&l.length)&&o.errors.length)return{errors:[{path:o.path,errors:o.errors}]};const v=o.inner.reduce((g,O)=>{const u=O.path||"";return g[u]||(g[u]={errors:[],path:u}),g[u].errors.push(...O.errors),g},{});return{errors:Object.values(v)}}}}}async function Xr(e,t){const n=await(ie(t.rules)?t.rules:Ft(t.rules)).parse(e,{formData:t.formData}),l=[];for(const o of n.errors)o.errors.length&&l.push(...o.errors);return{value:n.value,errors:l}}async function Yr(e,t,r){const n=Er(r.name);if(!n)throw new Error(`No such validator '${r.name}' exists.`);const l=Qr(r.params,e.formData),o={field:e.label||e.name,name:e.name,label:e.label,value:t,form:e.formData,rule:Object.assign(Object.assign({},r),{params:l})},v=await n(t,l,o);return typeof v=="string"?{error:v}:{error:v?void 0:Pt(o)}}function Pt(e){const t=we().generateMessage;return t?t(e):"Field is invalid"}function Qr(e,t){const r=n=>Ir(n)?n(t):n;return Array.isArray(e)?e.map(r):Object.keys(e).reduce((n,l)=>(n[l]=r(e[l]),n),{})}async function Jr(e,t){const n=await(ie(e)?e:Ft(e)).parse(A(t),{formData:A(t)}),l={},o={};for(const v of n.errors){const g=v.errors,O=(v.path||"").replace(/\["(\d+)"\]/g,(u,d)=>`[${d}]`);l[O]={valid:!g.length,errors:g},g.length&&(o[O]=g[0])}return{valid:!n.errors.length,results:l,errors:o,values:n.value,source:"schema"}}async function Zr(e,t,r){const l=G(e).map(async u=>{var d,E,I;const N=(d=r?.names)===null||d===void 0?void 0:d[u],B=await Wr(M(t,u),e[u],{name:N?.name||u,label:N?.label,values:t,bails:(I=(E=r?.bailsMap)===null||E===void 0?void 0:E[u])!==null&&I!==void 0?I:!0});return Object.assign(Object.assign({},B),{path:u})});let o=!0;const v=await Promise.all(l),g={},O={};for(const u of v)g[u.path]={valid:u.valid,errors:u.errors},u.valid||(o=!1,O[u.path]=u.errors[0]);return{valid:o,results:g,errors:O,source:"schema"}}let xr=0;const Ne=["bails","fieldsCount","id","multiple","type","validate"];function _t(e){const t=e?.initialValues||{},r=Object.assign({},y(t)),n=x(e?.validationSchema);return n&&ie(n)&&Q(n.cast)?A(n.cast(r)||{}):A(r)}function en(e){var t;const r=xr++,n=e?.name||"Form";let l=0;const o=Y(!1),v=Y(!1),g=Y(0),O=[],u=ke(_t(e)),d=Y([]),E=Y({}),I=Y({}),N=Ur(()=>{I.value=d.value.reduce((i,s)=>(i[Pe(y(s.path))]=s,i),{})});function B(i,s){const a=T(i);if(!a){typeof i=="string"&&(E.value[Pe(i)]=yt(s));return}if(typeof i=="string"){const c=Pe(i);E.value[c]&&delete E.value[c]}a.errors=yt(s),a.valid=!a.errors.length}function K(i){G(i).forEach(s=>{B(s,i[s])})}e?.initialErrors&&K(e.initialErrors);const le=z(()=>{const i=d.value.reduce((s,a)=>(a.errors.length&&(s[y(a.path)]=a.errors),s),{});return Object.assign(Object.assign({},E.value),i)}),re=z(()=>G(le.value).reduce((i,s)=>{const a=le.value[s];return a?.length&&(i[s]=a[0]),i},{})),ge=z(()=>d.value.reduce((i,s)=>(i[y(s.path)]={name:y(s.path)||"",label:s.label||""},i),{})),ye=z(()=>d.value.reduce((i,s)=>{var a;return i[y(s.path)]=(a=s.bails)!==null&&a!==void 0?a:!0,i},{})),ae=Object.assign({},e?.initialErrors||{}),h=(t=e?.keepValuesOnUnmount)!==null&&t!==void 0?t:!1,{initialValues:f,originalInitialValues:b,setInitialValues:w}=rn(d,u,e),j=tn(d,u,b,re),C=z(()=>d.value.reduce((i,s)=>{const a=M(u,y(s.path));return R(i,y(s.path),a),i},{})),F=e?.validationSchema;function L(i,s){var a,c;const p=z(()=>M(f.value,y(i))),V=I.value[y(i)],m=s?.type==="checkbox"||s?.type==="radio";if(V&&m){V.multiple=!0;const W=l++;return Array.isArray(V.id)?V.id.push(W):V.id=[V.id,W],V.fieldsCount++,V.__flags.pendingUnmount[W]=!1,V}const _=z(()=>M(u,y(i))),k=y(i),$=ce.findIndex(W=>W===k);$!==-1&&ce.splice($,1);const P=z(()=>{var W,Ve,Ke,We;const Ge=y(F);if(ie(Ge))return(Ve=(W=Ge.describe)===null||W===void 0?void 0:W.call(Ge,y(i)).required)!==null&&Ve!==void 0?Ve:!1;const He=y(s?.schema);return ie(He)&&(We=(Ke=He.describe)===null||Ke===void 0?void 0:Ke.call(He).required)!==null&&We!==void 0?We:!1}),D=l++,q=ke({id:D,path:i,touched:!1,pending:!1,valid:!0,validated:!!(!((a=ae[k])===null||a===void 0)&&a.length),required:P,initialValue:p,errors:rr([]),bails:(c=s?.bails)!==null&&c!==void 0?c:!1,label:s?.label,type:s?.type||"default",value:_,multiple:!1,__flags:{pendingUnmount:{[D]:!1},pendingReset:!1},fieldsCount:1,validate:s?.validate,dirty:z(()=>!oe(x(_),x(p)))});return d.value.push(q),I.value[k]=q,N(),re.value[k]&&!ae[k]&&Z(()=>{de(k,{mode:"silent"})}),ut(i)&&ee(i,W=>{N();const Ve=A(_.value);I.value[W]=q,Z(()=>{R(u,W,Ve)})}),q}const Re=gt(ot,5),be=gt(ot,5),je=Mr(async i=>await(i==="silent"?Re():be()),(i,[s])=>{const a=G(te.errorBag.value),p=[...new Set([...G(i.results),...d.value.map(V=>V.path),...a])].sort().reduce((V,m)=>{var _;const k=m,$=T(k)||Ue(k),P=((_=i.results[k])===null||_===void 0?void 0:_.errors)||[],D=y($?.path)||k,q=nn({errors:P,valid:!P.length},V.results[D]);return V.results[D]=q,q.valid||(V.errors[D]=q.errors[0]),$&&E.value[D]&&delete E.value[D],$?($.valid=q.valid,s==="silent"||s==="validated-only"&&!$.validated||B($,q.errors),V):(B(D,P),V)},{valid:i.valid,results:{},errors:{},source:i.source});return i.values&&(p.values=i.values,p.source=i.source),G(p.results).forEach(V=>{var m;const _=T(V);_&&s!=="silent"&&(s==="validated-only"&&!_.validated||B(_,(m=p.results[V])===null||m===void 0?void 0:m.errors))}),p});function ue(i){d.value.forEach(i)}function T(i){const s=typeof i=="string"?Pe(i):i;return typeof s=="string"?I.value[s]:s}function Ue(i){return d.value.filter(a=>i.startsWith(y(a.path))).reduce((a,c)=>a?c.path.length>a.path.length?c:a:c,void 0)}let ce=[],fe;function U(i){return ce.push(i),fe||(fe=Z(()=>{[...ce].sort().reverse().forEach(a=>{ht(u,a)}),ce=[],fe=null})),fe}function J(i){return function(a,c){return function(V){return V instanceof Event&&(V.preventDefault(),V.stopPropagation()),ue(m=>m.touched=!0),o.value=!0,g.value++,ve().then(m=>{const _=A(u);if(m.valid&&typeof a=="function"){const k=A(C.value);let $=i?k:_;return m.values&&($=m.source==="schema"?m.values:Object.assign({},$,m.values)),a($,{evt:V,controlledValues:k,setErrors:K,setFieldError:B,setTouched:ze,setFieldTouched:Ce,setValues:$e,setFieldValue:se,resetForm:Be,resetField:st})}!m.valid&&typeof c=="function"&&c({values:_,evt:V,errors:m.errors,results:m.results})}).then(m=>(o.value=!1,m),m=>{throw o.value=!1,m})}}}const Oe=J(!1);Oe.withControlled=J(!0);function Nt(i,s){const a=d.value.findIndex(p=>p.path===i&&(Array.isArray(p.id)?p.id.includes(s):p.id===s)),c=d.value[a];if(!(a===-1||!c)){if(Z(()=>{de(i,{mode:"silent",warn:!1})}),c.multiple&&c.fieldsCount&&c.fieldsCount--,Array.isArray(c.id)){const p=c.id.indexOf(s);p>=0&&c.id.splice(p,1),delete c.__flags.pendingUnmount[s]}(!c.multiple||c.fieldsCount<=0)&&(d.value.splice(a,1),it(i),N(),delete I.value[i])}}function kt(i){G(I.value).forEach(s=>{s.startsWith(i)&&delete I.value[s]}),d.value=d.value.filter(s=>!s.path.startsWith(i)),Z(()=>{N()})}const te={name:n,formId:r,values:u,controlledValues:C,errorBag:le,errors:re,schema:F,submitCount:g,meta:j,isSubmitting:o,isValidating:v,fieldArrays:O,keepValuesOnUnmount:h,validateSchema:x(F)?je:void 0,validate:ve,setFieldError:B,validateField:de,setFieldValue:se,setValues:$e,setErrors:K,setFieldTouched:Ce,setTouched:ze,resetForm:Be,resetField:st,handleSubmit:Oe,useFieldModel:zt,defineInputBinds:Bt,defineComponentBinds:Lt,defineField:qe,stageInitialValue:$t,unsetInitialValue:it,setFieldInitialValue:Le,createPathState:L,getPathState:T,unsetPathValue:U,removePathState:Nt,initialValues:f,getAllPathStates:()=>d.value,destroyPath:kt,isFieldTouched:Mt,isFieldDirty:Rt,isFieldValid:Ut};function se(i,s,a=!0){const c=A(s),p=typeof i=="string"?i:i.path;T(p)||L(p),R(u,p,c),a&&de(p)}function Tt(i,s=!0){G(u).forEach(a=>{delete u[a]}),G(i).forEach(a=>{se(a,i[a],!1)}),s&&ve()}function $e(i,s=!0){Ee(u,i),O.forEach(a=>a&&a.reset()),s&&ve()}function De(i,s){const a=T(y(i))||L(i);return z({get(){return a.value},set(c){var p;const V=y(i);se(V,c,(p=y(s))!==null&&p!==void 0?p:!1)}})}function Ce(i,s){const a=T(i);a&&(a.touched=s)}function Mt(i){const s=T(i);return s?s.touched:d.value.filter(a=>a.path.startsWith(i)).some(a=>a.touched)}function Rt(i){const s=T(i);return s?s.dirty:d.value.filter(a=>a.path.startsWith(i)).some(a=>a.dirty)}function Ut(i){const s=T(i);return s?s.valid:d.value.filter(a=>a.path.startsWith(i)).every(a=>a.valid)}function ze(i){if(typeof i=="boolean"){ue(s=>{s.touched=i});return}G(i).forEach(s=>{Ce(s,!!i[s])})}function st(i,s){var a;const c=s&&"value"in s?s.value:M(f.value,i),p=T(i);p&&(p.__flags.pendingReset=!0),Le(i,A(c),!0),se(i,c,!1),Ce(i,(a=s?.touched)!==null&&a!==void 0?a:!1),B(i,s?.errors||[]),Z(()=>{p&&(p.__flags.pendingReset=!1)})}function Be(i,s){let a=A(i?.values?i.values:b.value);a=s?.force?a:Ee(b.value,a),a=ie(F)&&Q(F.cast)?F.cast(a):a,w(a,{force:s?.force}),ue(c=>{var p;c.__flags.pendingReset=!0,c.validated=!1,c.touched=((p=i?.touched)===null||p===void 0?void 0:p[y(c.path)])||!1,se(y(c.path),M(a,y(c.path)),!1),B(y(c.path),void 0)}),s?.force?Tt(a,!1):$e(a,!1),K(i?.errors||{}),g.value=i?.submitCount||0,Z(()=>{ve({mode:"silent"}),ue(c=>{c.__flags.pendingReset=!1})})}async function ve(i){const s=i?.mode||"force";if(s==="force"&&ue(m=>m.validated=!0),te.validateSchema)return te.validateSchema(s);v.value=!0;const a=await Promise.all(d.value.map(m=>m.validate?m.validate(i).then(_=>({key:y(m.path),valid:_.valid,errors:_.errors,value:_.value})):Promise.resolve({key:y(m.path),valid:!0,errors:[],value:void 0})));v.value=!1;const c={},p={},V={};for(const m of a)c[m.key]={valid:m.valid,errors:m.errors},m.value&&R(V,m.key,m.value),m.errors.length&&(p[m.key]=m.errors[0]);return{valid:a.every(m=>m.valid),results:c,errors:p,values:V,source:"fields"}}async function de(i,s){var a;const c=T(i);if(c&&s?.mode!=="silent"&&(c.validated=!0),F){const{results:p}=await je(s?.mode||"validated-only");return p[i]||{errors:[],valid:!0}}return c?.validate?c.validate(s):(!c&&(a=s?.warn),Promise.resolve({errors:[],valid:!0}))}function it(i){ht(f.value,i)}function $t(i,s,a=!1){Le(i,s),R(u,i,s),a&&!e?.initialValues&&R(b.value,i,A(s))}function Le(i,s,a=!1){R(f.value,i,A(s)),a&&R(b.value,i,A(s))}async function ot(){const i=x(F);if(!i)return{valid:!0,results:{},errors:{},source:"none"};v.value=!0;const s=Et(i)||ie(i)?await Jr(i,u):await Zr(i,u,{names:ge.value,bailsMap:ye.value});return v.value=!1,s}const Dt=Oe((i,{evt:s})=>{kr(s)&&s.target.submit()});er(()=>{if(e?.initialErrors&&K(e.initialErrors),e?.initialTouched&&ze(e.initialTouched),e?.validateOnMount){ve();return}te.validateSchema&&te.validateSchema("silent")}),ut(F)&&ee(F,()=>{var i;(i=te.validateSchema)===null||i===void 0||i.call(te,"validated-only")}),ct(At,te);function qe(i,s){const a=Q(s)?void 0:s?.label,c=T(y(i))||L(i,{label:a}),p=()=>Q(s)?s(_e(c,Ne)):s||{};function V(){var P;c.touched=!0,((P=p().validateOnBlur)!==null&&P!==void 0?P:we().validateOnBlur)&&de(y(c.path))}function m(){var P;((P=p().validateOnInput)!==null&&P!==void 0?P:we().validateOnInput)&&Z(()=>{de(y(c.path))})}function _(){var P;((P=p().validateOnChange)!==null&&P!==void 0?P:we().validateOnChange)&&Z(()=>{de(y(c.path))})}const k=z(()=>{const P={onChange:_,onInput:m,onBlur:V};return Q(s)?Object.assign(Object.assign({},P),s(_e(c,Ne)).props||{}):s?.props?Object.assign(Object.assign({},P),s.props(_e(c,Ne))):P});return[De(i,()=>{var P,D,q;return(q=(P=p().validateOnModelUpdate)!==null&&P!==void 0?P:(D=we())===null||D===void 0?void 0:D.validateOnModelUpdate)!==null&&q!==void 0?q:!0}),k]}function zt(i){return Array.isArray(i)?i.map(s=>De(s,!0)):De(i)}function Bt(i,s){const[a,c]=qe(i,s);function p(){c.value.onBlur()}function V(_){const k=bt(_);se(y(i),k,!1),c.value.onInput()}function m(_){const k=bt(_);se(y(i),k,!1),c.value.onChange()}return z(()=>Object.assign(Object.assign({},c.value),{onBlur:p,onInput:V,onChange:m,value:a.value}))}function Lt(i,s){const[a,c]=qe(i,s),p=T(y(i));function V(m){a.value=m}return z(()=>{const m=Q(s)?s(_e(p,Ne)):s||{};return Object.assign({[m.model||"modelValue"]:a.value,[`onUpdate:${m.model||"modelValue"}`]:V},c.value)})}const lt=Object.assign(Object.assign({},te),{values:St(u),handleReset:()=>Be(),submitForm:Dt});return ct(jr,lt),lt}function tn(e,t,r,n){const l={touched:"some",pending:"some",valid:"every"},o=z(()=>!oe(t,x(r)));function v(){const O=e.value;return G(l).reduce((u,d)=>{const E=l[d];return u[d]=O[E](I=>I[d]),u},{})}const g=ke(v());return wt(()=>{const O=v();g.touched=O.touched,g.valid=O.valid,g.pending=O.pending}),z(()=>Object.assign(Object.assign({initialValues:x(r)},g),{valid:g.valid&&!G(n.value).length,dirty:o.value}))}function rn(e,t,r){const n=_t(r),l=Y(n),o=Y(A(n));function v(g,O){O?.force?(l.value=A(g),o.value=A(g)):(l.value=Ee(A(l.value)||{},A(g)),o.value=Ee(A(o.value)||{},A(g))),O?.updateFields&&e.value.forEach(u=>{if(u.touched)return;const E=M(l.value,y(u.path));R(t,y(u.path),A(E))})}return{initialValues:l,originalInitialValues:o,setInitialValues:v}}function nn(e,t){return t?{valid:e.valid&&t.valid,errors:[...e.errors,...t.errors]}:e}function Vt(e){const t=Tr(At,void 0),r=Y([]),n=()=>{},l={fields:r,remove:n,push:n,swap:n,insert:n,update:n,replace:n,prepend:n,move:n};if(!t||!x(e))return l;const o=t.fieldArrays.find(h=>x(h.path)===x(e));if(o)return o;let v=0;function g(){return M(t?.values,y(e),[])||[]}function O(){const h=g();Array.isArray(h)&&(r.value=h.map((f,b)=>d(f,b,r.value)),u())}O();function u(){const h=r.value.length;for(let f=0;f<h;f++){const b=r.value[f];b.isFirst=f===0,b.isLast=f===h-1}}function d(h,f,b){if(b&&!pe(f)&&b[f])return b[f];const w=v++;return{key:w,value:Rr({get(){const C=M(t?.values,y(e),[])||[],F=r.value.findIndex(L=>L.key===w);return F===-1?h:C[F]},set(C){const F=r.value.findIndex(L=>L.key===w);F!==-1&&re(F,C)}}),isFirst:!1,isLast:!1}}function E(){u(),t?.validate({mode:"silent"})}function I(h){const f=y(e),b=M(t?.values,f);if(!b||!Array.isArray(b))return;const w=[...b];w.splice(h,1);const j=f+`[${h}]`;t.destroyPath(j),t.unsetInitialValue(j),R(t.values,f,w),r.value.splice(h,1),E()}function N(h){const f=A(h),b=y(e),w=M(t?.values,b),j=pe(w)?[]:w;if(!Array.isArray(j))return;const C=[...j];C.push(f),t.stageInitialValue(b+`[${C.length-1}]`,f),R(t.values,b,C),r.value.push(d(f)),E()}function B(h,f){const b=y(e),w=M(t?.values,b);if(!Array.isArray(w)||!(h in w)||!(f in w))return;const j=[...w],C=[...r.value],F=j[h];j[h]=j[f],j[f]=F;const L=C[h];C[h]=C[f],C[f]=L,R(t.values,b,j),r.value=C,u()}function K(h,f){const b=A(f),w=y(e),j=M(t?.values,w);if(!Array.isArray(j)||j.length<h)return;const C=[...j],F=[...r.value];C.splice(h,0,b),F.splice(h,0,d(b)),R(t.values,w,C),r.value=F,E()}function le(h){const f=y(e);t.stageInitialValue(f,h),R(t.values,f,h),O(),E()}function re(h,f){const b=y(e),w=M(t?.values,b);!Array.isArray(w)||w.length-1<h||(R(t.values,`${b}[${h}]`,f),t?.validate({mode:"validated-only"}))}function ge(h){const f=A(h),b=y(e),w=M(t?.values,b),j=pe(w)?[]:w;if(!Array.isArray(j))return;const C=[f,...j];R(t.values,b,C),t.stageInitialValue(b+"[0]",f),r.value.unshift(d(f)),E()}function ye(h,f){const b=y(e),w=M(t?.values,b),j=pe(w)?[]:[...w];if(!Array.isArray(w)||!(h in w)||!(f in w))return;const C=[...r.value],F=C[h];C.splice(h,1),C.splice(f,0,F);const L=j[h];j.splice(h,1),j.splice(f,0,L),R(t.values,b,j),r.value=C,E()}const ae={fields:r,remove:I,push:N,swap:B,insert:K,update:re,replace:le,prepend:ge,move:ye};return t.fieldArrays.push(Object.assign({path:e,reset:O},ae)),tr(()=>{const h=t.fieldArrays.findIndex(f=>y(f.path)===y(e));h>=0&&t.fieldArrays.splice(h,1)}),ee(g,h=>{const f=r.value.map(b=>b.value);oe(h,f)||O()}),ae}const sn=["type","value"],on={key:0,class:"text-red-400"},ln=Ze({__name:"CustomInput",props:{modelValue:{},type:{default:"text"},error:{}},emits:["update:modelValue","blur"],setup(e){return(t,r)=>(X(),H("div",null,[S("input",{type:e.type,value:e.modelValue,onInput:r[0]||(r[0]=n=>t.$emit("update:modelValue",n.target?.value??"")),onBlur:r[1]||(r[1]=n=>t.$emit("blur")),class:et(["form-control",{"border-red-500":e.error}])},null,42,sn),e.error?(X(),H("span",on,Ae(e.error),1)):xe("",!0)]))}}),an=tt(ln,[["__scopeId","data-v-b78548c9"]]),un=["type","value"],cn={key:0,class:"text-red-400"},dn=Ze({__name:"CustomTextArea",props:{modelValue:{},type:{default:"text"},error:{}},emits:["update:modelValue","blur"],setup(e){return(t,r)=>(X(),H("div",null,[S("textarea",{type:e.type,value:e.modelValue,onInput:r[0]||(r[0]=n=>t.$emit("update:modelValue",n.target?.value??"")),onBlur:r[1]||(r[1]=n=>t.$emit("blur")),class:et(["form-control",{"border-red-500":e.error}])},null,42,un),e.error?(X(),H("span",cn,Ae(e.error),1)):xe("",!0)]))}}),fn=tt(dn,[["__scopeId","data-v-1c63c93f"]]),vn=lr({title:Ie().required().min(3),slug:Ie().required(),description:Ie().required(),price:dt().required().min(0),stock:dt().required().min(1),gender:Ie().oneOf(["men","women","kid"]).required()}),mn=Ze({components:{CustomInput:an,CustomTextArea:fn},name:"ProductView",props:{productId:{type:String,required:!0}},setup(e){const t=ir(),r=or(),{data:n,isError:l,isLoading:o,refetch:v}=vr({queryKey:["product",e.productId],queryFn:()=>hr(e.productId),retry:!1}),{mutate:g,isPending:O,isSuccess:u,data:d}=pr({mutationFn:gr}),{values:E,defineField:I,errors:N,handleSubmit:B,resetForm:K,meta:le}=en({validationSchema:vn}),[re,ge]=I("title"),[ye,ae]=I("slug"),[h,f]=I("description"),[b,w]=I("price"),[j,C]=I("stock"),[F,L]=I("gender"),{fields:Re}=Vt("images"),{fields:be,remove:je,push:ue}=Vt("sizes"),T=Y([]),Ue=B(U=>{const J={...U,images:[...U.images,...T.value]};g(J)}),ce=U=>{const J=be.value.map(ne=>ne.value);if(J.includes(U)){const ne=J.indexOf(U);je(ne)}else ue(U)},fe=U=>{const ne=U.target.files;if(ne&&ne.length!==0)for(const Oe of ne)T.value.push(Oe)};return wt(()=>{if(console.log("Loaded product:",n.value),l.value&&!o.value){t.replace({name:"admin-products"});return}}),ee(n,()=>{n&&K({values:n.value})},{deep:!0,immediate:!0}),ee(u,U=>{U&&(r.success("Producto actualizado correctamente"),t.replace(`/admin/product/${d.value.id}`),K({values:d.value}),T.value=[])}),ee(()=>e.productId,()=>{v()}),{values:E,errors:N,meta:le,title:re,titleAttrs:ge,slug:ye,slugAttrs:ae,description:h,descriptionAttrs:f,price:b,priceAttrs:w,stock:j,stockAttrs:C,gender:F,genderAttrs:L,isPending:O,imagesSubidas:T,onFileChange:fe,imageFields:Re,sizesFields:be,allSizes:["XS","S","M","L","XL","XXL"],onSubmit:Ue,toggleSize:ce,hasSize:U=>be.value.some(J=>J.value===U),temporalImageUrls:U=>URL.createObjectURL(U)}}}),pn={class:"bg-white px-5 py-2 rounded"},hn={class:"text-3xl"},gn={class:"text-blue-500"},yn={class:"first-col"},bn={class:"mb-4"},On={class:"mb-4"},Vn={class:"mb-4"},Sn={class:"flex flex-row gap-3"},wn={class:"mb-4 flex-1"},An={class:"mb-4 flex-1"},En={class:"mb-4"},jn={class:"flex"},Cn=["onClick"],In={class:"first-col"},Fn={class:"flex p-2 overflow-x-auto space-x-8 w-full h-[265px] bg-gray-200 rounded"},Pn=["src","alt"],_n=["src"],Nn={class:"col-span-2 my-2"},kn={class:"mb-4"},Tn={key:0,class:"text-red-400"},Mn={class:"my-4 text-right"},Rn=["disabled"];function Un(e,t,r,n,l,o){const v=Xe("custom-input"),g=Xe("CustomInput"),O=Xe("CustomTextArea");return X(),H(Fe,null,[S("div",pn,[S("h1",hn,[t[8]||(t[8]=ar(" Producto: ",-1)),S("small",gn,Ae(e.title),1)]),t[9]||(t[9]=S("hr",{class:"my-4"},null,-1))]),S("form",{onSubmit:t[7]||(t[7]=(...u)=>e.onSubmit&&e.onSubmit(...u)),class:"grid grid-cols-1 sm:grid-cols-2 bg-white px-5 gap-5"},[S("div",yn,[S("div",bn,[t[10]||(t[10]=S("label",{for:"title",class:"form-label"},"Título",-1)),Se(v,me({modelValue:e.title,"onUpdate:modelValue":t[0]||(t[0]=u=>e.title=u)},e.titleAttrs,{error:e.errors.title}),null,16,["modelValue","error"])]),S("div",On,[t[11]||(t[11]=S("label",{for:"slug",class:"form-label"},"Slug",-1)),Se(g,me({modelValue:e.slug,"onUpdate:modelValue":t[1]||(t[1]=u=>e.slug=u)},e.slugAttrs,{error:e.errors.slug}),null,16,["modelValue","error"])]),S("div",Vn,[t[12]||(t[12]=S("label",{for:"description",class:"form-label"},"Descripción",-1)),Se(O,me({modelValue:e.description,"onUpdate:modelValue":t[2]||(t[2]=u=>e.description=u)},e.descriptionAttrs,{error:e.errors.description}),null,16,["modelValue","error"])]),S("div",Sn,[S("div",wn,[t[13]||(t[13]=S("label",{for:"price",class:"form-label"},"Precio",-1)),Se(v,me({modelValue:e.price,"onUpdate:modelValue":t[3]||(t[3]=u=>e.price=u),modelModifiers:{number:!0}},e.priceAttrs,{error:e.errors.price}),null,16,["modelValue","error"])]),S("div",An,[t[14]||(t[14]=S("label",{for:"stock",class:"form-label"},"Inventario",-1)),Se(v,me({modelValue:e.stock,"onUpdate:modelValue":t[4]||(t[4]=u=>e.stock=u),modelModifiers:{number:!0}},e.stockAttrs,{error:e.errors.stock}),null,16,["modelValue","error"])])]),S("div",En,[t[15]||(t[15]=S("label",{for:"sizes",class:"form-label"},"Tallas",-1)),S("div",jn,[(X(!0),H(Fe,null,Ye(e.allSizes,u=>(X(),H("button",{key:u,onClick:d=>e.toggleSize(u),type:"button",class:et(["p-2 rounded w-14 mr-2 flex-1",{"bg-blue-500 text-white":e.hasSize(u),"bg-blue-100":!e.hasSize(u)}])},Ae(u),11,Cn))),128))])])]),S("div",In,[t[19]||(t[19]=S("label",{for:"stock",class:"form-label"},"Imágenes",-1)),S("div",Fn,[(X(!0),H(Fe,null,Ye(e.imageFields,u=>(X(),H("div",{key:u.value,class:"flex-shrink-0"},[S("img",{src:u.value,alt:e.title,class:"w-[250px] h-[250px] rounded"},null,8,Pn)]))),128)),(X(!0),H(Fe,null,Ye(e.imagesSubidas,u=>(X(),H("div",{key:u.name,class:"flex-shrink-0"},[S("img",{src:e.temporalImageUrls(u),class:"w-[250px] h-[250px] rounded"},null,8,_n)]))),128))]),S("div",Nn,[t[16]||(t[16]=S("label",{for:"image",class:"form-label"},"Subir imagen",-1)),S("input",{multiple:"",type:"file",id:"image",class:"form-control",accept:"images/*",onChange:t[5]||(t[5]=(...u)=>e.onFileChange&&e.onFileChange(...u))},null,32)]),S("div",kn,[t[18]||(t[18]=S("label",{for:"stock",class:"form-label"},"Género",-1)),ur(S("select",me({"onUpdate:modelValue":t[6]||(t[6]=u=>e.gender=u)},e.genderAttrs,{class:"form-control"}),[...t[17]||(t[17]=[S("option",{value:""},"Seleccione",-1),S("option",{value:"kid"},"Niño",-1),S("option",{value:"women"},"Mujer",-1),S("option",{value:"men"},"Hombre",-1)])],16),[[cr,e.gender]]),e.errors.gender?(X(),H("span",Tn,Ae(e.errors.gender),1)):xe("",!0)]),S("div",Mn,[S("button",{disabled:e.isPending,type:"submit",class:"disabled:bg-gray-300 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"}," Guardar ",8,Rn)])])],32)],64)}const zn=tt(mn,[["render",Un],["__scopeId","data-v-35c963aa"]]);export{zn as default};
